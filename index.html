<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bendahara Terintegrasi</title>
<style>
  body { font-family: Arial, sans-serif; margin:20px; }
  table { width:100%; border-collapse: collapse; margin-top:20px; }
  th, td { border:1px solid #ccc; padding:8px; text-align:center; }
  th { background:#f2f2f2; }
  input, select, button { padding:5px; margin:3px; }
</style>
</head>
<body>

<h2>Bendahara Terintegrasi</h2>

<div>
  <label>Tanggal: <input type="date" id="tanggal"></label>
  <label>Keterangan: 
    <select id="keterangan">
      <option value="Pemasukan">Pemasukan</option>
      <option value="Pengeluaran">Pengeluaran</option>
    </select>
  </label>
  <label>Jumlah: <input type="number" id="jumlah" min="0"></label>
  <label>Keterangan Tambahan: <input type="text" id="keterangan2"></label>
  <button onclick="tambahTransaksi()">Tambah</button>
</div>

<table id="tabel">
  <thead>
    <tr>
      <th>ID</th>
      <th>Tanggal</th>
      <th>Keterangan</th>
      <th>Debit</th>
      <th>Kredit</th>
      <th>Saldo</th>
      <th>Keterangan Tambahan</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<p>Total Pemasukan: <span id="totalPemasukan">0</span></p>
<p>Total Pengeluaran: <span id="totalPengeluaran">0</span></p>
<p>Saldo Akhir: <span id="saldoAkhir">0</span></p>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxzptBZECDM3ilyR6iTs3UNzMDU5gkoni26g_kkJ8N5mgnjcZRgG0MUU8kAvnkbIT61Gg/exec";

async function fetchData() {
  const res = await fetch(API_URL);
  const json = await res.json();
  if(json.success){
    renderTable(json.data);
    document.getElementById('totalPemasukan').innerText = json.totals.pemasukan;
    document.getElementById('totalPengeluaran').innerText = json.totals.pengeluaran;
    document.getElementById('saldoAkhir').innerText = json.totals.saldo;
  } else {
    alert("Gagal mengambil data: " + json.message);
  }
}

function renderTable(rows){
  const tbody = document.querySelector("#tabel tbody");
  tbody.innerHTML = "";
  rows.forEach(r => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${r.id}</td>
      <td>${r.tanggal}</td>
      <td>${r.keterangan}</td>
      <td>${r.debit}</td>
      <td>${r.kredit}</td>
      <td>${r.saldo}</td>
      <td>${r.keterangan2}</td>
    `;
    tbody.appendChild(tr);
  });
}

async function tambahTransaksi(){
  const tanggal = document.getElementById('tanggal').value;
  const keterangan = document.getElementById('keterangan').value;
  const jumlah = document.getElementById('jumlah').value;
  const keterangan2 = document.getElementById('keterangan2').value;

  if(!tanggal || !jumlah){
    alert("Tanggal dan jumlah wajib diisi!");
    return;
  }

  const params = new URLSearchParams({tanggal,keterangan,jumlah,keterangan2});
  
  const res = await fetch(API_URL + "?" + params.toString(), {
    method: "POST"
  });
  const json = await res.json();
  if(json.success){
    alert("Transaksi berhasil ditambahkan!");
    document.getElementById('tanggal').value = "";
    document.getElementById('jumlah').value = "";
    document.getElementById('keterangan2').value = "";
    fetchData();
  } else {
    alert("Gagal menambahkan: " + json.message);
  }
}

// Load data pertama kali
fetchData();
</script>

</body>
</html>
